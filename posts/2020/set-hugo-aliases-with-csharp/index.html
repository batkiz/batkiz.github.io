<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><link rel=prev href=https://blog.batkiz.com/posts/2019/using-wsl-nvim-in-powershell/><link rel=next href=https://blog.batkiz.com/posts/2020/how-seo-ruined-the-internet/><link rel=canonical href=https://blog.batkiz.com/posts/2020/set-hugo-aliases-with-csharp/><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>用 C# 设置 Hugo Aliases | not b@tk1z</title><meta name=title content="用 C# 设置 Hugo Aliases | not b@tk1z"><link rel=stylesheet href=/font/iconfont.css><style type=text/css>@import '/css/light.min.css';@import url('/css/dark.min.css') screen and (prefers-color-scheme:dark)</style><meta name=twitter:card content="summary"><meta name=twitter:title content="用 C# 设置 Hugo Aliases"><meta name=twitter:description content="2020 年新年好！ 相信细心的读者已经注意到了，本博客的文章链接已经全部从 blog.batkiz.com/:year/:month/:day/:filename/ 调整为了 blog.batkiz.com/posts/:year/:filename/ 的 url 格式。主要的原因是 url 的可读性：一则我个人认为让完整的日期出"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"用 C# 设置 Hugo Aliases","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.batkiz.com\/posts\/2020\/set-hugo-aliases-with-csharp\/"},"image":{"@type":"ImageObject","url":"https:\/\/blog.batkiz.com\/cover.png","width":800,"height":600},"genre":"posts","keywords":"csharp, hugo","wordcount":898,"url":"https:\/\/blog.batkiz.com\/posts\/2020\/set-hugo-aliases-with-csharp\/","datePublished":"2020-01-05T00:53:07\u002b08:00","dateModified":"2020-01-05T00:53:07\u002b08:00","publisher":{"@type":"Organization","name":"batkiz","logo":{"@type":"ImageObject","url":"https:\/\/blog.batkiz.com\/logo.png","width":127,"height":40}},"author":{"@type":"Person","name":"batkiz"},"description":""}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=https://blog.batkiz.com/>not b@tk1z</a></div><div class="menu navbar-right"><a class=menu-item href=/posts/>Posts</a>
<a class=menu-item href=/tags/>Tags</a>
<a class=menu-item href=/about>About</a>
<a class=menu-item href=/atom.xml>RSS</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=https://blog.batkiz.com/>not b@tk1z</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=/posts/>Posts</a>
<a class=menu-item href=/tags/>Tags</a>
<a class=menu-item href=/about>About</a>
<a class=menu-item href=/atom.xml>RSS</a></div></div></nav><main class=main><div class=container><article class=post-warp><header class=post-header><h1 class=post-title>用 C# 设置 Hugo Aliases</h1><div class=post-meta>by <a href=https://blog.batkiz.com/ rel=author>batkiz</a>
<span class=post-time>on <time datetime="January 5, 2020">January 5, 2020</time></span></div></header><div class=post-content><p>2020 年新年好！</p><p>相信细心的读者已经注意到了，本博客的文章链接已经全部从 <code>blog.batkiz.com/:year/:month/:day/:filename/</code> 调整为了 <code>blog.batkiz.com/posts/:year/:filename/</code> 的 url 格式。主要的原因是 url 的可读性：一则我个人认为让完整的日期出现在文章的 url 中对“人”非常之不友好。比如我曾想直接输入文章链接访问文章时，日期极大地为我原本就不太好的记忆力增加了负担。另一方面，具体而完整的时间对于读者也是不必要的，几乎没有人会关注文章是在几月几号几点写的，作为读者，更关注的点在于内容，在 url 中隐藏掉具体的时间，只给出一个年份，在我看来是某种程度上的平衡。</p><p>其实这个想法早在将博客生成器由 hexo 切换到 hugo 时就有了，但是由于兼容性的问题（我在煎蛋等平台上的投稿有到我文章的链接），我不能让原本的文章给 404 掉，所以当时只能忍辱负重，继续使用含有完整日期的 url。（见<a href=/posts/2019/migrate-to-hugo-and-automation/>此文</a>）</p><p>而在某天晚上我刷牙洗漱时，我突然想到，能否将 url 更改的同时，设置以带有完整日期链接的访问跳转到新的链接。经过一番搜索，我找到了名为 <a href=https://gohugo.io/content-management/urls/#aliases>Aliases</a> 的功能，这正是我要找的！</p><p>但是，在打算用这个功能时，我犯了难：博客经过三年多的积累，文章的量并不是我能够手动一篇一篇的修改的了的。当然啦，作为一个程序员，第一时间想到的，当然就是通过写代码来自动化啦。</p><p>通过观察，所添加的 Aliases 项应被添加在 frontmatter 中，其主要依赖了文章的日期即 date 项。我最开始的想法是，将每篇文章的 frontmatter （在我的文章中用的是 yaml）序列化，对序列化后的项进行修改，最后再反序列化，保存至文章。</p><p>但是由于我并没有找到一个可用性较高的解析 markdown 文件 yaml frontmatter 的库，此想法只好作罢。</p><p>经过我的进一步观察，每篇文章的 date 项均处在第三行，且格式为</p><pre><code class=language-yaml>date: yyyy-mm-dd time
</code></pre><p>事情就好办了起来。</p><p>核心思想即：读入文本，将位于第三行的日期解析出来->生成 Aliases 项->写入文本。</p><p>下面是代码（C# 8, dotnet core 3.1），由于时间匆忙，且需求简单，因此未做过多的处理。</p><pre><code class=language-cs>using System.Linq;
using System.IO;
using System;

namespace AddAliasToBlogPosts
{
    class Program
    {
        static void Main(string[] args)
        {
            string dir = @&quot;C:\code\blog-contents\content\posts&quot;;
            var posts = GetPosts(dir);

            foreach (var item in posts)
            {
                AppendAlias(GetAlias(item), item, 3);
                //System.Console.WriteLine(GetAlias(item));
            }
        }

        static string[] GetPosts(string dir) =&gt; Directory.GetFiles(dir);


        static string GetFilesName(string path)
        {
            path = path.Split('\\').Last();
            return path.Substring(0, path.Length - 3);
        }
        static string GetLine(string text, int lineNo)
        {
            string[] lines = text.Replace(&quot;\r&quot;, &quot;&quot;).Split('\n');
            return lines.Length &gt;= lineNo ? lines[lineNo - 1] : null;
        }

        static Func&lt;string, string&gt; GetTime = (path) =&gt;
        {
            string text = File.ReadAllText(path);
            string time = GetLine(text, 3);
            return time.Substring(6, 10).Replace('-', '/');
        };

        static Func&lt;string, string&gt; GetAlias = (path)
             =&gt; $&quot;\naliases:\n    - /{GetTime(path)}/{GetFilesName(path)}/&quot;;

        static void AppendAlias(string newText, string fileName, int line_to_edit)
        {
            string[] arrLine = File.ReadAllLines(fileName);
            arrLine[line_to_edit - 1] += newText;
            File.WriteAllLines(fileName, arrLine);
        }
    }
}

</code></pre><p>最后，感谢 MSDN 与 StackOverflow。</p></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>batkiz</span></p><p class=copyright-item></p><p class=copyright-item><span>LICENSE:</span>
<span>如无特殊声明，本博客文章均以 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a> 协议发布</span></p></div><div class=post-tags><section><i class="iconfont icon-icon-tag"></i>Tag:
<span class=tag><a href=https://blog.batkiz.com/tags/csharp/>#csharp</a></span>
<span class=tag><a href=https://blog.batkiz.com/tags/hugo/>#hugo</a></span></section><section><a href=javascript:window.history.back();>Back</a></span> ·
<span><a href=https://blog.batkiz.com/>Home</a></span></section></div><div class=post-nav><a href=https://blog.batkiz.com/posts/2019/using-wsl-nvim-in-powershell/ class=prev rel=prev title="在 powershell 中无缝调用 wsl 中的 neovim"><i class="iconfont icon-dajiantou"></i>&nbsp;在 powershell 中无缝调用 wsl 中的 neovim</a>
<a href=https://blog.batkiz.com/posts/2020/how-seo-ruined-the-internet/ class=next rel=next title="翻译 | SEO 是如何毁掉互联网的">翻译 | SEO 是如何毁掉互联网的&nbsp;<i class="iconfont icon-xiaojiantou"></i></a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2017 - 2020</span>
<span class=author itemprop=copyrightHolder><a href=https://blog.batkiz.com/>batkiz</a> |</span>
<span>powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreffer">Hugo</a>
& <a href=https://github.com/batkiz/left target=_blank rel="external nofollow noopener noreffer">left</a></span></div></footer><script src=https://cdnjs.loli.net/ajax/libs/jquery/3.2.1/jquery.min.js></script><script src=/js/dynamic.to.top.min.min.js async></script><script src=/js/main.min.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-111900041-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "fd2a175921e640c8a40b873fb5e58aaa"}'></script><style type=text/css>@import '//cdnjs.loli.net/ajax/libs/prism/1.20.0/themes/prism-solarizedlight.min.css';@import url('//cdnjs.loli.net/ajax/libs/prism/1.20.0/themes/prism-tomorrow.min.css') screen and (prefers-color-scheme:dark)</style><script src=https://cdnjs.loli.net/ajax/libs/prism/1.20.0/components/prism-core.min.js></script><script src=https://cdnjs.loli.net/ajax/libs/prism/1.20.0/plugins/autoloader/prism-autoloader.min.js data-autoloader-path=https://cdnjs.loli.net/ajax/libs/prism/1.20.0/components/></script></div></body></html>