<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><link rel=prev href=https://blog.batkiz.com/posts/2019/using-wsl-nvim-in-powershell/><link rel=canonical href=https://blog.batkiz.com/posts/2020/set-hugo-aliases-with-csharp/><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>用 C# 设置 Hugo Aliases | not b@tk1z</title><meta name=title content="用 C# 设置 Hugo Aliases | not b@tk1z"><link rel=stylesheet href=/font/iconfont.css><link rel=stylesheet href=/css/main.min.css><meta name=twitter:card content="summary"><meta name=twitter:title content="用 C# 设置 Hugo Aliases"><meta name=twitter:description content="2020 年新年好！ 相信细心的读者已经注意到了，本博客的文章链接已经全部从 blog.batkiz.com/:year/:month/:day/:filename/ 调整为了 blog.batkiz.com/posts/:year/:filename/ 的 url 格式。主要的原因是 url 的可读性：一则我个人认为让完整的日期出"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"用 C# 设置 Hugo Aliases","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.batkiz.com\/posts\/2020\/set-hugo-aliases-with-csharp\/"},"image":{"@type":"ImageObject","url":"https:\/\/blog.batkiz.com\/cover.png","width":800,"height":600},"genre":"posts","wordcount":898,"url":"https:\/\/blog.batkiz.com\/posts\/2020\/set-hugo-aliases-with-csharp\/","datePublished":"2020-01-05T00:53:07\x2b08:00","dateModified":"2020-01-05T00:53:07\x2b08:00","publisher":{"@type":"Organization","name":"batkiz","logo":{"@type":"ImageObject","url":"https:\/\/blog.batkiz.com\/logo.png","width":127,"height":40}},"author":{"@type":"Person","name":"batkiz"},"description":""}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=https://blog.batkiz.com/>not b@tk1z</a></div><div class="menu navbar-right"><a class=menu-item href=/posts/>Posts</a>
<a class=menu-item href=/tags/>Tags</a>
<a class=menu-item href=/about>About</a>
<a class=menu-item href=/atom.xml>RSS</a>
<a href=javascript:void(0); class=theme-switch><i class="iconfont icon-sun"></i></a>&nbsp;</div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-sun"></i></a>&nbsp;<a href=https://blog.batkiz.com/>not b@tk1z</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=/posts/>Posts</a>
<a class=menu-item href=/tags/>Tags</a>
<a class=menu-item href=/about>About</a>
<a class=menu-item href=/atom.xml>RSS</a></div></div></nav><main class=main><div class=container><article class=post-warp><header class=post-header><h1 class=post-title>用 C# 设置 Hugo Aliases</h1><div class=post-meta>by <a href=https://blog.batkiz.com/ rel=author>batkiz</a>
<span class=post-time>on <time datetime=2020-01-05>5 January 2020</time></span></div></header><div class=post-content><p>2020 年新年好！</p><p>相信细心的读者已经注意到了，本博客的文章链接已经全部从 <code>blog.batkiz.com/:year/:month/:day/:filename/</code> 调整为了 <code>blog.batkiz.com/posts/:year/:filename/</code> 的 url 格式。主要的原因是 url 的可读性：一则我个人认为让完整的日期出现在文章的 url 中对“人”非常之不友好。比如我曾想直接输入文章链接访问文章时，日期极大地为我原本就不太好的记忆力增加了负担。另一方面，具体而完整的时间对于读者也是不必要的，几乎没有人会关注文章是在几月几号几点写的，作为读者，更关注的点在于内容，在 url 中隐藏掉具体的时间，只给出一个年份，在我看来是某种程度上的平衡。</p><p>其实这个想法早在将博客生成器由 hexo 切换到 hugo 时就有了，但是由于兼容性的问题（我在煎蛋等平台上的投稿有到我文章的链接），我不能让原本的文章给 404 掉，所以当时只能忍辱负重，继续使用含有完整日期的 url。（见<a href=/posts/2019/migrate-to-hugo-and-automation/>此文</a>）</p><p>而在某天晚上我刷牙洗漱时，我突然想到，能否将 url 更改的同时，设置以带有完整日期链接的访问跳转到新的链接。经过一番搜索，我找到了名为 <a href=https://gohugo.io/content-management/urls/#aliases>Aliases</a> 的功能，这正是我要找的！</p><p>但是，在打算用这个功能时，我犯了难：博客经过三年多的积累，文章的量并不是我能够手动一篇一篇的修改的了的。当然啦，作为一个程序员，第一时间想到的，当然就是通过写代码来自动化啦。</p><p>通过观察，所添加的 Aliases 项应被添加在 frontmatter 中，其主要依赖了文章的日期即 date 项。我最开始的想法是，将每篇文章的 frontmatter （在我的文章中用的是 yaml）序列化，对序列化后的项进行修改，最后再反序列化，保存至文章。</p><p>但是由于我并没有找到一个可用性较高的解析 markdown 文件 yaml frontmatter 的库，此想法只好作罢。</p><p>经过我的进一步观察，每篇文章的 date 项均处在第三行，且格式为</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>date</span>: yyyy-mm-dd time
</code></pre></div><p>事情就好办了起来。</p><p>核心思想即：读入文本，将位于第三行的日期解析出来->生成 Aliases 项->写入文本。</p><p>下面是代码（C# 8, dotnet core 3.1），由于时间匆忙，且需求简单，因此未做过多的处理。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=color:#66d9ef>using</span> System.Linq;
<span style=color:#66d9ef>using</span> System.IO;
<span style=color:#66d9ef>using</span> System;

<span style=color:#66d9ef>namespace</span> AddAliasToBlogPosts
{
    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Program</span>
    {
        <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> Main(<span style=color:#66d9ef>string</span>[] args)
        {
            <span style=color:#66d9ef>string</span> dir = <span style=color:#e6db74>@&#34;C:\code\blog-contents\content\posts&#34;</span>;
            <span style=color:#66d9ef>var</span> posts = GetPosts(dir);

            <span style=color:#66d9ef>foreach</span> (<span style=color:#66d9ef>var</span> item <span style=color:#66d9ef>in</span> posts)
            {
                AppendAlias(GetAlias(item), item, <span style=color:#ae81ff>3</span>);
                <span style=color:#75715e>//System.Console.WriteLine(GetAlias(item));
</span><span style=color:#75715e></span>            }
        }

        <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>string</span>[] GetPosts(<span style=color:#66d9ef>string</span> dir) =&gt; Directory.GetFiles(dir);


        <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>string</span> GetFilesName(<span style=color:#66d9ef>string</span> path)
        {
            path = path.Split(<span style=color:#e6db74>&#39;\\&#39;</span>).Last();
            <span style=color:#66d9ef>return</span> path.Substring(<span style=color:#ae81ff>0</span>, path.Length - <span style=color:#ae81ff>3</span>);
        }
        <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>string</span> GetLine(<span style=color:#66d9ef>string</span> text, <span style=color:#66d9ef>int</span> lineNo)
        {
            <span style=color:#66d9ef>string</span>[] lines = text.Replace(<span style=color:#e6db74>&#34;\r&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>).Split(<span style=color:#e6db74>&#39;\n&#39;</span>);
            <span style=color:#66d9ef>return</span> lines.Length &gt;= lineNo ? lines[lineNo - <span style=color:#ae81ff>1</span>] : <span style=color:#66d9ef>null</span>;
        }

        <span style=color:#66d9ef>static</span> Func&lt;<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>string</span>&gt; GetTime = (path) =&gt;
        {
            <span style=color:#66d9ef>string</span> text = File.ReadAllText(path);
            <span style=color:#66d9ef>string</span> time = GetLine(text, <span style=color:#ae81ff>3</span>);
            <span style=color:#66d9ef>return</span> time.Substring(<span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>1</span><span style=color:#ae81ff>0</span>).Replace(<span style=color:#e6db74>&#39;-&#39;</span>, <span style=color:#e6db74>&#39;/&#39;</span>);
        };

        <span style=color:#66d9ef>static</span> Func&lt;<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>string</span>&gt; GetAlias = (path)
             =&gt; <span style=color:#e6db74>$&#34;\naliases:\n    - /{GetTime(path)}/{GetFilesName(path)}/&#34;</span>;

        <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> AppendAlias(<span style=color:#66d9ef>string</span> newText, <span style=color:#66d9ef>string</span> fileName, <span style=color:#66d9ef>int</span> line_to_edit)
        {
            <span style=color:#66d9ef>string</span>[] arrLine = File.ReadAllLines(fileName);
            arrLine[line_to_edit - <span style=color:#ae81ff>1</span>] += newText;
            File.WriteAllLines(fileName, arrLine);
        }
    }
}

</code></pre></div><p>最后，感谢 MSDN 与 StackOverflow。</p></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>batkiz</span></p><p class=copyright-item></p><p class=copyright-item><span>LICENSE:</span>
<span>如无特殊说明，本博客文章均以 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a> 协议发布</span></p></div><div class=post-tags><section><a href=javascript:window.history.back();>Back</a></span> ·
<span><a href=https://blog.batkiz.com/>Home</a></span></section></div><div class=post-nav><a href=https://blog.batkiz.com/posts/2019/using-wsl-nvim-in-powershell/ class=prev rel=prev title="在 powershell 中无缝调用 wsl 中的 neovim"><i class="iconfont icon-dajiantou"></i>&nbsp;在 powershell 中无缝调用 wsl 中的 neovim</a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2017 - 2020</span>
<span class=author itemprop=copyrightHolder><a href=https://blog.batkiz.com/>batkiz</a> |</span>
<span>powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreffer">Hugo</a> & <a href=https://github.com/batkiz/left target=_blank rel="external nofollow noopener noreffer">left</a></span></div></footer><script src=/js/vendor_no_gallery.min.js async></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-111900041-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script type=text/javascript async src="https://lib.baomitu.com/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({"HTML-CSS":{preferredFont:"TeX",availableFonts:["STIX","TeX"],linebreaks:{automatic:true},EqnChunk:(MathJax.Hub.Browser.isMobile?10:50)},tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],processEscapes:true,ignoreClass:"tex2jax_ignore|dno",skipTags:['script','noscript','style','textarea','pre','code']},TeX:{noUndefined:{attributes:{mathcolor:"red",mathbackground:"#FFEEEE",mathsize:"90%"}},Macros:{href:"{}"}},messageStyle:"none"});MathJax.Hub.Queue(function(){var all=MathJax.Hub.getAllJax(),i;for(i=0;i<all.length;i+=1){all[i].SourceElement().parentNode.className+=' has-jax';}});</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><link href=https://lib.baomitu.com/prism/1.17.1/themes/prism-tomorrow.min.css rel=stylesheet><script src=https://lib.baomitu.com/prism/1.17.1/components/prism-core.min.js></script><script src=https://lib.baomitu.com/prism/1.17.1/plugins/autoloader/prism-autoloader.min.js data-autoloader-path=https://lib.baomitu.com/prism/1.17.1/components/></script></div></body></html>