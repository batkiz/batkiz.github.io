<!doctype html><html lang=zh><head><meta name=viewport content="width=device-width,initial-scale=1"><title>博客迁移至 Hugo 并实现自动化</title>
<meta charset=utf-8><meta name=description content="Ladder@好久不见！ 自 6 月以来，本人虽然没什么产出，但怎奈没动力写博客，至今只写了两篇不疼不痒的综述文章。但今天（2019/10/20）偶然在 v2ex 上看到"><meta name=author content="Jinglue"><link rel=canonical href=https://blog.batkiz.com/posts/migrate-to-hugo-and-automation/><link rel=alternate type=application/rss+xml href=https://blog.batkiz.com//index.xml title="not b@tk1z"><meta property="og:url" content="https://blog.batkiz.com/posts/migrate-to-hugo-and-automation/"><meta property="og:site_name" content="not b@tk1z"><meta property="og:title" content="博客迁移至 Hugo 并实现自动化"><meta property="og:description" content="好久不见！ 自 6 月以来，本人虽然没什么产出，但怎奈没动力写博客，至今只写了两篇不疼不痒的综述文章。但今天（2019/10/20）偶然在 v2ex 上看到"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-10-20T22:01:44+08:00"><meta property="article:modified_time" content="2019-10-20T22:01:44+08:00"><meta property="article:tag" content="Hugo"><meta name=twitter:card content="summary"><meta name=twitter:title content="博客迁移至 Hugo 并实现自动化"><meta name=twitter:description content="好久不见！ 自 6 月以来，本人虽然没什么产出，但怎奈没动力写博客，至今只写了两篇不疼不痒的综述文章。但今天（2019/10/20）偶然在 v2ex 上看到"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"博客迁移至 Hugo 并实现自动化","item":"https://blog.batkiz.com/posts/migrate-to-hugo-and-automation/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"博客迁移至 Hugo 并实现自动化","name":"博客迁移至 Hugo 并实现自动化","description":"好久不见！ 自 6 月以来，本人虽然没什么产出，但怎奈没动力写博客，至今只写了两篇不疼不痒的综述文章。但今天（2019/10/20）偶然在 v2ex 上看到","keywords":["hugo"],"articleBody":"好久不见！\n自 6 月以来，本人虽然没什么产出，但怎奈没动力写博客，至今只写了两篇不疼不痒的综述文章。但今天（2019/10/20）偶然在 v2ex 上看到了 hexo 释出 4.0 版本 的消息，而后想到自己曾数次想要脱离贵前端生态圈，摆脱令人脑壳痛的依赖问题，实现博客自动化等等等等事情。\n于是，我趁着今天是闲暇的周日，把一切事情办好了。\n下面是过程复现与总结。\nHugo 其实最早我并不是太想换到 Hugo 的，但奈何自己想要写一个静态博客生成器的计划一直提不上日程…… 便选择了这个解决方案。\n之后是主题的选择。由于 Hugo 的主题生态圈较之 Hexo 仍较为匮乏，因此选择并不多。经过我在各种网站上的搜罗与比较，下面列出我较为偏向的选择：\nMaupassant，这个是我在 Hexo 上一直使用的主题，但 Hugo 上的移植版我不太满意，pass。 https://linw1995.com/，这个主题我十分喜欢，但由于没有提供主题的 repo，只能作罢。 LeaveIt，这个主题看着还行，但太久没维护，都没办法用…… KeepIt，这个是上面 LeaveIt 的 fork，也是我最终的选择。 但由于 KeepIt 的功能还是不太能满足我的需求，因此我又 fork 了一份，作为自用。地址 batkiz/left\n开始迁移 整个迁移过程中，我最在意的是该死的 兼容性 ，即，我新生成的博客要与之前的博客在整体行为上没有太大变化，下面就是在保证兼容性前提下的迁移过程。\n链接 之前的链接不能直接 404，让读者找不到文章（虽然原来就没啥读者），不能造成割裂行为。\nHexo 默认的链接生成方法为 /:year/:month/:day/:filename/，而 Hugo 的则为 /:year/:filename/。\n解决很简单，修改为相同的即可。\nRSS 之前在 hexo 之上构建时，我采用的 hexo 插件是生成出 atom.xml 文件的，而在新的主题下生成的则是 index.xml。\n解决方法：在 config.toml 中加入下列内容\n[outputs] home = [\"Atom\", \"HTML\"] [outputFormats.Atom] mediatype = \"application/rss\" baseName = \"atom\" 即可生成 atom.xml 文件作为 RSS feed。\n在成功解决上述兼容性问题之后，新问题随之而来：为什么生成的 xml 里 tmd 没有内容？\n为解决此问题，我试着看了看源码，但看不懂（\n接着我试了试 Google，感谢 kaushalmodi 的代码，我用它覆盖了 index.atom.xml 之后便成功部署了正确的 RSS，简单修改（将默认的只生成最近 6 条增加到 20）之后便符合了需求。\nmathjax 虽然我平时很少输入数学公式，但这个功能也不能少！\n首先我尝试了将 mathjax 的支持直接写入 head/footer/js 等几个模板，但，还是没用（即使我已经在源码中看到了 mathjax 的支持代码）。\n接下来仍然是 Google。\n感谢 匿蟒，我在 在 Hugo 中使用 MathJax 一文中找到了解决方案，即下述方法：\n在添加 MathJax 时，把所有修改写成了一个 layouts/partials/mathjax.html 文件：\n\u003cscript type=\"text/javascript\" async src=\"https://cdn.bootcss.com/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML\" \u003e MathJax.Hub.Config({ \"HTML-CSS\": {preferredFont: \"TeX\", availableFonts: [\"STIX\", \"TeX\"], linebreaks: { automatic: true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) }, tex2jax: {inlineMath: [[\"$\", \"$\"], [\"\\\\(\", \"\\\\)\"]], processEscapes: true, ignoreClass: \"tex2jax_ignore|dno\", skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'] }, TeX: {noUndefined: { attributes: { mathcolor: \"red\", mathbackground: \"#FFEEEE\", mathsize: \"90%\"} }, Macros: { href: \"{}\" } }, messageStyle: \"none\" }); MathJax.Hub.Queue(function () { var all = MathJax.Hub.getAllJax(), i; for (i = 0; i \u003c all.length; i += 1) { all[i].SourceElement().parentNode.className += 'has-jax'; } }); \u003c/script\u003e \u003cstyle\u003e code.has-jax { font: inherit; font-size: 100%; background: inherit; border: inherit; color: #515151; } \u003c/style\u003e 这里，把官网的三处修改合并成一个 partial。 此外，还把 MathJax 的 CDN 从 cdnjs.cloudflare.com 替换成了 cdn.bootcss.com，更好地支持国内。\n把这个 partial 模板添加到 中，即可正常工作。\n{{partial \"mathjax.html\" .}} frontmatter Hugo 支持 toml, yml 与 json 格式的 frontmatter，但与 Hexo 的 yml frontmatter 又有所不同。\nHugo 中的 tags 的形式应为\ntags: - hello - world - etc 即使只有一个 tag ，也要按此格式来写，否则会编译错误。\n此外还有 title 的值应被包裹在括号之中等。\n另外，hexo 中的 time 项可不用修改，Hugo 似乎已支持了此种格式。\n版本控制与自动化 很久之前也曾想过要实现博客的云同步与自动化部署，但当时没有余力去做，今天趁着迁移博客，顺带利用 GitHub actions 实现自动化。\n版本控制 首先是对内容（markdown 文件）的版本控制。\n对 hugo new site . 生成出来的文件夹，使用 git init ，并添加以下的 .gitignore 信息：\n/archetypes/\r/data/\r/layouts/\r/public/\r/resources/\r/static/\r/themes/ 这样的话，只有下面两项被加入了版本控制之中：\ncontent/，这个是文章所在的文件夹 config.toml，这个是 hugo 的配置文件 之后可以将此目录推向 GitHub，进行文章的版本控制与部署的自动化。\n自动化 Hugo 的无依赖特性、配置都写在根目录下的 config.toml 文件中的功能与 GitHub Actions 的出现，使得文章自动部署变得极为简单。毫不夸张的说，在最初的配置之后，我们可以专注于文章的内容，本地甚至不需要有 Hugo 的存在。\n下面是 GitHub Actions 的 workflow，详情请看注释。\nname: blog on: [push] jobs: build: name: Build runs-on: ubuntu-latest steps: # 使用预编译的 Hugo 二进制文件 - name: Setup Hugo uses: peaceiris/actions-hugo@v2.2.2 with: hugo-version: \"latest\" # 使用 Hugo-extended 版本 extended: true # 新建站点 - name: new site run: | hugo new site $HOME/blog # 获取主题 - name: get theme run: | git clone --depth=1 https://github.com/batkiz/left.git $HOME/blog/themes/left # 获取 username.github.io 以保持 commit 记录 - name: get username.github.io run: | git clone --no-checkout https://github.com/batkiz/batkiz.github.io.git $HOME/blog/public # 获取内容文件 - uses: actions/checkout@v1 with: fetch-depth: 1 # 将内容文件复制进入站点内 - name: copy in run: | rm -rf $HOME/blog/config.toml $HOME/blog/content/ /bin/cp -rf config.toml $HOME/blog/config.toml /bin/cp -rf content/ $HOME/blog/content/ # build - name: build run: | cd $HOME/blog HUGO_ENV=production hugo --gc --minify # 将生成出的站点推向 username.github.io - name: publish env: USER: batkiz EMAIL: batkiz@outlook.com GH_REF: github.com/batkiz/batkiz.github.io.git # 这里的 token 需要自己在 GitHub settings 中部署，并利用 actions 的 secrets 功能 GH_TOKEN: ${{ secrets.GH_TOKEN }} run: | cd $HOME/blog/public git config --global user.name $USER git config --global user.email $EMAIL git add . git commit -m \"Auto Update: `date +'%Y-%m-%d %H:%M:%S'`\" git push \"https://$USER:$GH_TOKEN@$GH_REF\" master:master 感谢 https://github.com/peaceiris/actions-hugo 提供的可在 GitHub actions 使用的 Hugo 二进制文件，避免了每次都手动编译 Hugo。\n另外希望大家别不看内容就随便写，会出 typo 的，然后 failed（泪\n结语 经过一个下午 + 一个晚上的努力，终于成功地把博客迁移到了 Hugo，并实现了内容的版本管理与自动化部署。可喜可贺，可喜可贺。\n接下来大概会抽空将以前的文章格式调整一下（Hugo 的 markdown 不知道是用啥解析的，写的随意的话不会按你想的那样渲染），以及自己写一个 Hugo 的主题。\nsee you later.\n","wordCount":"2105","inLanguage":"zh","datePublished":"2019-10-20T22:01:44+08:00","dateModified":"2019-10-20T22:01:44+08:00","author":{"@type":"Person","name":"Jinglue"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.batkiz.com/posts/migrate-to-hugo-and-automation/"},"publisher":{"@type":"Organization","name":"not b@tk1z","logo":{"@type":"ImageObject","url":"https://blog.batkiz.com/favicon.ico"}}}</script><link rel=icon href=/favicon.ico sizes=16x16><link rel=apple-touch-icon href=/favicon.ico><link rel=manifest href=/favicon.ico><link rel=preconnect href=https://fonts.loli.net><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.loli.net/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap" rel=stylesheet><link href="https://fonts.loli.net/css2?family=Noto+Serif+SC&family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap" rel=stylesheet><link href="https://fonts.loli.net/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=Noto+Serif+SC&family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap" rel=stylesheet><link rel=stylesheet href=/css/main.min.28245603abfbc0a0a9ef30287c2872f82f0e6075e5b630bff570c8480b95b904.css integrity="sha256-KCRWA6v7wKCp7zAofChy+C8OYHXltjC/9XDISAuVuQQ=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>not b@tk1z
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/posts>文章</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/links>链接</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/atom.xml>RSS</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/about>关于</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/batkiz><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-social"><a class=navigation-link href=mailto:batkiz@outlook.com><svg viewBox="0 0 24 24" width="20" height="20" class="main-grid-item-icon" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>博客迁移至 Hugo 并实现自动化</h1></header><p><small>2019年10月20日&nbsp;· 2105 字&nbsp;· 5 分钟</small>
<small>·
<a href=https://blog.batkiz.com/tags/hugo/>Hugo</a></small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#hugo>Hugo</a></li><li><a href=#开始迁移>开始迁移</a><ul><li><a href=#链接>链接</a></li><li><a href=#rss>RSS</a></li><li><a href=#mathjax>mathjax</a></li><li><a href=#frontmatter>frontmatter</a></li></ul></li><li><a href=#版本控制与自动化>版本控制与自动化</a><ul><li><a href=#版本控制>版本控制</a></li><li><a href=#自动化>自动化</a></li></ul></li><li><a href=#结语>结语</a></li></ul></nav></div><section class=blog-content><p>好久不见！</p><p>自 6 月以来，本人虽然没什么产出，但怎奈没动力写博客，至今只写了两篇不疼不痒的综述文章。但今天（2019/10/20）偶然在 v2ex 上看到了 <a href=https://www.v2ex.com/t/611063>hexo 释出 4.0 版本</a> 的消息，而后想到自己曾数次想要脱离贵前端生态圈，摆脱令人脑壳痛的依赖问题，实现博客自动化等等等等事情。</p><p>于是，我趁着今天是闲暇的周日，把一切事情办好了。</p><p>下面是过程复现与总结。</p><h2 id=hugo>Hugo</h2><p>其实最早我并不是太想换到 Hugo 的，但奈何自己想要写一个静态博客生成器的计划一直提不上日程…… 便选择了这个解决方案。</p><p>之后是主题的选择。由于 Hugo 的主题生态圈较之 Hexo 仍较为匮乏，因此选择并不多。经过我在各种网站上的搜罗与比较，下面列出我较为偏向的选择：</p><ul><li>Maupassant，这个是我在 Hexo 上一直使用的主题，但 Hugo 上的移植版我不太满意，pass。</li><li><a href=https://linw1995.com/>https://linw1995.com/</a>，这个主题我十分喜欢，但由于没有提供主题的 repo，只能作罢。</li><li><a href=https://github.com/liuzc/LeaveIt>LeaveIt</a>，这个主题看着还行，但太久没维护，都没办法用……</li><li><a href=https://github.com/Fastbyte01/KeepIt>KeepIt</a>，这个是上面 LeaveIt 的 fork，也是我最终的选择。</li></ul><p>但由于 KeepIt 的功能还是不太能满足我的需求，因此我又 fork 了一份，作为自用。地址 <a href=https://github.com/batkiz/left>batkiz/left</a></p><h2 id=开始迁移>开始迁移</h2><p>整个迁移过程中，我最在意的是该死的 <strong>兼容性</strong> ，即，我新生成的博客要与之前的博客在整体行为上没有太大变化，下面就是在保证兼容性前提下的迁移过程。</p><h3 id=链接>链接</h3><p>之前的链接不能直接 404，让读者找不到文章（虽然原来就没啥读者），不能造成割裂行为。</p><p>Hexo 默认的链接生成方法为 <code>/:year/:month/:day/:filename/</code>，而 Hugo 的则为 <code>/:year/:filename/</code>。</p><p>解决很简单，修改为相同的即可。</p><h3 id=rss>RSS</h3><p>之前在 hexo 之上构建时，我采用的 hexo 插件是生成出 <code>atom.xml</code> 文件的，而在新的主题下生成的则是 <code>index.xml</code>。</p><p>解决方法：在 <code>config.toml</code> 中加入下列内容</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>outputs</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>home</span> = [<span style=color:#e6db74>&#34;Atom&#34;</span>, <span style=color:#e6db74>&#34;HTML&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>outputFormats</span>.<span style=color:#a6e22e>Atom</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mediatype</span> = <span style=color:#e6db74>&#34;application/rss&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>baseName</span> = <span style=color:#e6db74>&#34;atom&#34;</span>
</span></span></code></pre></div><p>即可生成 <code>atom.xml</code> 文件作为 RSS feed。</p><p>在成功解决上述兼容性问题之后，新问题随之而来：<strong>为什么生成的 xml 里 tmd 没有内容？</strong></p><p>为解决此问题，我试着看了看源码，但看不懂（</p><p>接着我试了试 Google，感谢 <a href=https://github.com/kaushalmodi/hugo-atom-feed>kaushalmodi</a> 的代码，我用它覆盖了 <code>index.atom.xml</code> 之后便成功部署了正确的 RSS，简单修改（将默认的只生成最近 6 条增加到 20）之后便符合了需求。</p><h3 id=mathjax>mathjax</h3><p>虽然我平时很少输入数学公式，但这个功能也不能少！</p><p>首先我尝试了将 mathjax 的支持直接写入 head/footer/js 等几个模板，但，还是没用（即使我已经在源码中看到了 mathjax 的支持代码）。</p><p>接下来仍然是 Google。</p><p>感谢 <a href=http://weibo.com/u/2837672545>匿蟒</a>，我在 <a href=https://note.qidong.name/2018/03/hugo-mathjax/>在 Hugo 中使用 MathJax</a> 一文中找到了解决方案，即下述方法：</p><p>在添加 <a href=https://www.mathjax.org/>MathJax</a> 时，把所有修改写成了一个 <code>layouts/partials/mathjax.html</code> 文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/javascript&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>async</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdn.bootcss.com/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML&#34;</span>
</span></span><span style=display:flex><span>&gt;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>MathJax</span>.<span style=color:#a6e22e>Hub</span>.<span style=color:#a6e22e>Config</span>({
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;HTML-CSS&#34;</span><span style=color:#f92672>:</span> {<span style=color:#a6e22e>preferredFont</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;TeX&#34;</span>, <span style=color:#a6e22e>availableFonts</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;STIX&#34;</span>, <span style=color:#e6db74>&#34;TeX&#34;</span>], <span style=color:#a6e22e>linebreaks</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>automatic</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> }, <span style=color:#a6e22e>EqnChunk</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>MathJax</span>.<span style=color:#a6e22e>Hub</span>.<span style=color:#a6e22e>Browser</span>.<span style=color:#a6e22e>isMobile</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>10</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>50</span>) },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>tex2jax</span><span style=color:#f92672>:</span> {<span style=color:#a6e22e>inlineMath</span><span style=color:#f92672>:</span> [[<span style=color:#e6db74>&#34;$&#34;</span>, <span style=color:#e6db74>&#34;$&#34;</span>], [<span style=color:#e6db74>&#34;\\(&#34;</span>, <span style=color:#e6db74>&#34;\\)&#34;</span>]], <span style=color:#a6e22e>processEscapes</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>, <span style=color:#a6e22e>ignoreClass</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;tex2jax_ignore|dno&#34;</span>, <span style=color:#a6e22e>skipTags</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;script&#39;</span>, <span style=color:#e6db74>&#39;noscript&#39;</span>, <span style=color:#e6db74>&#39;style&#39;</span>, <span style=color:#e6db74>&#39;textarea&#39;</span>, <span style=color:#e6db74>&#39;pre&#39;</span>, <span style=color:#e6db74>&#39;code&#39;</span>] },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>TeX</span><span style=color:#f92672>:</span> {<span style=color:#a6e22e>noUndefined</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>attributes</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>mathcolor</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;red&#34;</span>, <span style=color:#a6e22e>mathbackground</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;#FFEEEE&#34;</span>, <span style=color:#a6e22e>mathsize</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;90%&#34;</span>} }, <span style=color:#a6e22e>Macros</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>href</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;{}&#34;</span> } },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>messageStyle</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;none&#34;</span>
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>MathJax</span>.<span style=color:#a6e22e>Hub</span>.<span style=color:#a6e22e>Queue</span>(<span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>all</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>MathJax</span>.<span style=color:#a6e22e>Hub</span>.<span style=color:#a6e22e>getAllJax</span>(), <span style=color:#a6e22e>i</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>all</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>all</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>SourceElement</span>().<span style=color:#a6e22e>parentNode</span>.<span style=color:#a6e22e>className</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39;has-jax&#39;</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>style</span>&gt;
</span></span><span style=display:flex><span>  <span style=color:#f92672>code</span>.<span style=color:#a6e22e>has-jax</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>font</span>: <span style=color:#66d9ef>inherit</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>font-size</span>: <span style=color:#ae81ff>100</span><span style=color:#66d9ef>%</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>background</span>: <span style=color:#66d9ef>inherit</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>border</span>: <span style=color:#66d9ef>inherit</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>color</span>: <span style=color:#ae81ff>#515151</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>style</span>&gt;
</span></span></code></pre></div><p>这里，把官网的三处修改合并成一个 partial。 此外，还把 <a href=https://www.mathjax.org/>MathJax</a> 的 CDN 从 <code>cdnjs.cloudflare.com</code> 替换成了 <code>cdn.bootcss.com</code>，更好地支持国内。</p><p>把这个 partial 模板添加到 <code>&lt;head></code> 中，即可正常工作。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>{{partial &#34;mathjax.html&#34; .}}
</span></span></code></pre></div><h3 id=frontmatter>frontmatter</h3><p>Hugo 支持 toml, yml 与 json 格式的 frontmatter，但与 Hexo 的 yml frontmatter 又有所不同。</p><p>Hugo 中的 tags 的形式应为</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>tags</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>hello</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>world</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>etc</span>
</span></span></code></pre></div><p>即使只有一个 tag ，也要按此格式来写，否则会编译错误。</p><p>此外还有 title 的值应被包裹在括号之中等。</p><p>另外，hexo 中的 time 项可不用修改，Hugo 似乎已支持了此种格式。</p><h2 id=版本控制与自动化>版本控制与自动化</h2><p>很久之前也曾想过要实现博客的云同步与自动化部署，但当时没有余力去做，今天趁着迁移博客，顺带利用 GitHub actions 实现自动化。</p><h3 id=版本控制>版本控制</h3><p>首先是对内容（markdown 文件）的版本控制。</p><p>对 <code>hugo new site .</code> 生成出来的文件夹，使用 <code>git init</code> ，并添加以下的 <code>.gitignore</code> 信息：</p><pre tabindex=0><code class=language-gitignore data-lang=gitignore>/archetypes/
/data/
/layouts/
/public/
/resources/
/static/
/themes/
</code></pre><p>这样的话，只有下面两项被加入了版本控制之中：</p><ul><li><code>content/</code>，这个是文章所在的文件夹</li><li><code>config.toml</code>，这个是 hugo 的配置文件</li></ul><p>之后可以将此目录推向 GitHub，进行文章的版本控制与部署的自动化。</p><h3 id=自动化>自动化</h3><p>Hugo 的无依赖特性、配置都写在根目录下的 config.toml 文件中的功能与 GitHub Actions 的出现，使得文章自动部署变得极为简单。毫不夸张的说，在最初的配置之后，我们可以专注于文章的内容，本地甚至不需要有 Hugo 的存在。</p><p>下面是 GitHub Actions 的 workflow，详情请看注释。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>blog</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>: [<span style=color:#ae81ff>push]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># 使用预编译的 Hugo 二进制文件</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Setup Hugo</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-hugo@v2.2.2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>hugo-version</span>: <span style=color:#e6db74>&#34;latest&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># 使用 Hugo-extended 版本</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>extended</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 新建站点</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>new site</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          hugo new site $HOME/blog</span>          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 获取主题</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>get theme</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git clone --depth=1 https://github.com/batkiz/left.git $HOME/blog/themes/left</span>          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 获取 username.github.io 以保持 commit 记录</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>get username.github.io</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git clone --no-checkout https://github.com/batkiz/batkiz.github.io.git $HOME/blog/public</span>          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 获取内容文件</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>fetch-depth</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 将内容文件复制进入站点内</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>copy in</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          rm -rf $HOME/blog/config.toml $HOME/blog/content/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          /bin/cp -rf config.toml $HOME/blog/config.toml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          /bin/cp -rf content/ $HOME/blog/content/</span>          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># build</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>build</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          cd $HOME/blog
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          HUGO_ENV=production hugo --gc --minify</span>          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># 将生成出的站点推向 username.github.io</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>publish</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>USER</span>: <span style=color:#ae81ff>batkiz</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>EMAIL</span>: <span style=color:#ae81ff>batkiz@outlook.com</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>GH_REF</span>: <span style=color:#ae81ff>github.com/batkiz/batkiz.github.io.git</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># 这里的 token 需要自己在 GitHub settings 中部署，并利用 actions 的 secrets 功能</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>GH_TOKEN</span>: <span style=color:#ae81ff>${{ secrets.GH_TOKEN }}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          cd $HOME/blog/public
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git config --global user.name $USER
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git config --global user.email $EMAIL
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git add .
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git commit -m &#34;Auto Update: `date +&#39;%Y-%m-%d %H:%M:%S&#39;`&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git push &#34;https://$USER:$GH_TOKEN@$GH_REF&#34; master:master</span>          
</span></span></code></pre></div><p>感谢 <a href=https://github.com/peaceiris/actions-hugo>https://github.com/peaceiris/actions-hugo</a> 提供的可在 GitHub actions 使用的 Hugo 二进制文件，避免了每次都手动编译 Hugo。</p><p>另外希望大家别不看内容就随便写，会出 typo 的，然后 failed（泪</p><h2 id=结语>结语</h2><p>经过一个下午 + 一个晚上的努力，终于成功地把博客迁移到了 Hugo，并实现了内容的版本管理与自动化部署。可喜可贺，可喜可贺。</p><p>接下来大概会抽空将以前的文章格式调整一下（Hugo 的 markdown 不知道是用啥解析的，写的随意的话不会按你想的那样渲染），以及自己写一个 Hugo 的主题。</p><p>see you later.</p></section><div class=paginator><a class=prev href=https://blog.batkiz.com/posts/sth-about-hosts-tool-2/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>写在 hosts-tool-go 0.1.0 之际</span></a>
<a class=next href=https://blog.batkiz.com/posts/c-using-vscode-and-tcc/><span>使用 VS Code 与 TinyCC 学习 C 语言</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2024 <a href=https://blog.batkiz.com/>not b@tk1z</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "fd2a175921e640c8a40b873fb5e58aaa"}'></script></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>