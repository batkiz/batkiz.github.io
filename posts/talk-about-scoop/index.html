<!doctype html><html lang=zh><head><meta name=viewport content="width=device-width,initial-scale=1"><title>在 winget 到来之际，再谈谈 scoop</title>
<meta charset=utf-8><meta name=description content="Ladder@Microsoft Build 2020 开发者大会在几天前召开了，除了 .NET, C# 等的常规更新之外，微软也发布了全新的、官方支持的命令行安装工具 winget。winget 出现的意义不"><meta name=author content="Jinglue"><link rel=canonical href=https://blog.batkiz.com/posts/talk-about-scoop/><link rel=alternate type=application/rss+xml href=https://blog.batkiz.com//index.xml title="not b@tk1z"><meta property="og:title" content="在 winget 到来之际，再谈谈 scoop"><meta property="og:description" content="Microsoft Build 2020 开发者大会在几天前召开了，除了 .NET, C# 等的常规更新之外，微软也发布了全新的、官方支持的命令行安装工具 winget。winget 出现的意义不"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.batkiz.com/posts/talk-about-scoop/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-21T15:56:06+08:00"><meta property="article:modified_time" content="2020-05-21T15:56:06+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="在 winget 到来之际，再谈谈 scoop"><meta name=twitter:description content="Microsoft Build 2020 开发者大会在几天前召开了，除了 .NET, C# 等的常规更新之外，微软也发布了全新的、官方支持的命令行安装工具 winget。winget 出现的意义不"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"在 winget 到来之际，再谈谈 scoop","item":"https://blog.batkiz.com/posts/talk-about-scoop/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"在 winget 到来之际，再谈谈 scoop","name":"在 winget 到来之际，再谈谈 scoop","description":"Microsoft Build 2020 开发者大会在几天前召开了，除了 .NET, C# 等的常规更新之外，微软也发布了全新的、官方支持的命令行安装工具 winget。winget 出现的意义不","keywords":["scoop","Windows","winget"],"articleBody":"Microsoft Build 2020 开发者大会在几天前召开了，除了 .NET, C# 等的常规更新之外，微软也发布了全新的、官方支持的命令行安装工具 winget。winget 出现的意义不用多说：Windows 终于迎来了受官方支持的命令行安装工具。此前虽然有 choco, scoop 等，但都只是第三方工具而已，如今微软第一方下场，无疑给开发者们带来了极大的鼓舞。\nwinget 的使用体验我一直有在 Telegram 频道 里更新，在这里不再多谈——winget 目前还没到 1.0 版本，现在只是 preview 而已，某些点今天谈完可能第二天就给更新了。或许到了 1.0 版本释出时我会再更一篇文章吧。\n谈谈 scoop 现有的问题 我在这里更想谈一谈 scoop 这个第三方的 cli installer。我一直一来都是一个 scoop 吹，本博客之前也曾介绍过 scoop1，但经过了这一年多的使用，我也逐渐意识到了许多问题，这些问题或许不是“痛点”，但却总让人有股隔靴搔痒的无力感。\n重名问题 当多个 bucket 内有同名 manifest 时，会按照 bucket 的顺序，自动安装最靠前的 manifest。比如我的 backit 与 main bucket 里都存在 ffsend，执行 scoop install ffsend 时，scoop 会安装 backit/ffsend，而非有一个询问。虽然可以用 scoop install main/ffsend 来指定安装，但 scoop 官方是应该注意到这一点的，而非让用户每次都 search 一下。\n不受关注的软件 scoop 的 bucket 是靠社区维护的，通常情况下这意味着 bug 更容易被发现——最先发现问题的人通常都会去开 issue 或 pull request。\n但当某个软件没那么受人关注，或人们根本没有发现其问题时，就出现另一个问题了：scoop 里的软件版本滞后于官方。\n比如 onefetch，在 2019/11/06 的 manifest 更新 2 之后，onefetch 在自己的 release 里发布了 3 个新版本3，而 scoop 里的 manifest 再无更新。虽然这是因为 onefetch 的 release 总是变换命名风格，但 scoop 应该尽力避免这一问题。\n人手过少与软件过多 ScoopInstaller 组织里公开显示的有 8 个人4，而足够活跃的仅仅有 @r15ch13 与 @Ash258 两个人5，scoop 并非一个有盈利的项目，这两位也都不是全职维护 scoop，这两人除了自己的本职工作外，能有多少时间投入进来呢？\n而仅 main 与 extras 两个 bucket 的软件数量，就已经达到了 1786 个，虽然有社区的力量，但每天 review PR 都够累死的。\n当一个 bucket 只有 20 个软件时（指我的 backit），维护者完全有精力隔三岔五地看一眼整个的 checkver 的 log，但当一个 bucket 有 200 个时，就完全不一样了。就比如现在的 main bucket 经常会出现更新滞后的情况，毕竟更新脚本跑起来也是需要时间的。（有兴趣的可以比较一下 batkiz/backit 与 ScoopInstaller/Main 里 ffsend 的更新时间。）\n功能停滞 人手过少带来的另一个问题就是 scoop 本身的功能更新几乎停滞，今年以来在 master 分支上仅仅有两个 commit6，还都是 fix。新功能的添加也是如此，scoop download 命令早在 2017 年就被 issue 提出，而 2019/12/06 的 #3782 PR 为 scoop 添加了此功能，一直未被合并，今年 5 月又被离奇关闭7。让人不得不担心 scoop 项目的发展。\n没有明确的 roadmap scoop 项目至今已经发展了 7 年，却仍没有一个明确的 roadmap，功能的更新也毫无规划。官方的几位开发者除了偶尔对 scoop 进行更新外，每天在忙的就是处理 bucket 里的各种 issue，审批望不到尽头的 PR。\nshim 带来的问题 scoop 的一个功能特性就是防止 Path pollution from installing lots of programs8，由于 Windows 上并没有像 *nix 上一样强大的链接，这一点是靠所谓的 shim 实现的。shim 的作用基本就是对 example 生成一个非常小的 example.exe，读取 example.shim 内指定的源 example.exe 路径，（传递命令行参数并）将其启动。\n这是一个非常聪明的做法，但有时候却也会带来问题。如在 Windows terminal 里，如果用 pwsh shim 作为启动的 shell，会导致对接收到的 Ctrl + c 的处理不正常：我们想要的是将当前正在运行的命令强行停止，pwsh shim 却会直接将 pwsh 停止。9虽然我们可以通过指定 pwsh 原路径的方法避免，但这又有违了 scoop 进行 shim 的初衷。\n依赖问题 有些读者可能看到这里会有些迷惑，解决依赖问题怎么会成为一个问题呢？*nix 上的包管理器不都是在吹自己能处理好依赖吗？\n在通常情况下有且仅有一个 package manager 的 *nix 系统之上，包管理器帮助解决依赖问题会很棒。\n但在 Windows 系统上，一切都变了：几乎所有软件都没有依赖，最多是 msvc runtime/dotnet runtime；同时用户安装软件的来源也是五花八门的：从官网下载的 exe 文件、MS Store、scoop、choco 等“包管理器”等等等等。\n这种情况下，当 scoop 试图接管依赖处理时，就非常令人不爽了。由于 scoop 是按 package 来设定的依赖，而非在环境变量中搜寻是否存在需要的 exe 文件。当你通过其他方式安装了 A，又想要通过 scoop 安装依赖于 A 的 B 时，scoop 只会再给你安装一份 A，非常之 unintelligible。10\n这样的依赖处理方式还带来了另外一个问题：卸载软件时，无法顺带卸载其不会再用到的依赖。scoop 并没有区分 lib 与 exe，这样也就无法确定你的软件是否能被安全地移除。最终只能是用户在无意间 scoop list 时，发现一个自己毫无印象的软件，然后将其卸载。\n我们真的如同我们想象的那般需要 portable 吗 scoop 在普通情况下非常之 portable，理论上 $env:SCOOP 下的文件可以在不同电脑间相互移动，所需要的仅仅是设定好 scoop 所需要的几个环境变量——但是等等，我们真的需要这一点吗？\nscoop 的 nonportable bucket 与种种以 -np 结尾的 manifest 已经证实了 portable 不是灵丹妙药，是不能解决所有的软件的：比如 Windows terminal 等以 appx 为打包格式的软件，根本无法指定安装地址；yarn-np 等软件如果进行极端的 portable 化会导致每次更新都丢数据。\n不可否认，这个世界上有很多人同时使用多台电脑，或者想要完全的 portable 软件。但对我们这些仅仅拥有一台电脑、并不太在意软件是否是 portable 的、甚至根本不在乎环境变量是不是被污染的人呢？为了 portable, path clean 而付出的额外的代价，我们是否也应该承受呢？仅就我而言，需要的可能只是一个恰倒好处的 CLI installer 罢了。\n设计一个 CLI installer scoop 无疑是一个值得使用的 package manager，上面列出了的种种缺点也都是站在我个人立场上的，毕竟吾之蜜糖，彼之砒霜，适合自己的才是最好的。\n但如果让我来设计的话，一个完全只符合我 个人需求 的 CLI installer 会是怎么样的呢？\n安装过程通过 pwsh 脚本定义，增强自由度。 对 exe, msi, appx 等用 inno, Add-AppxPackage 等安装，参考 winget。 对 zip 进行解压等，将 manifest 中定义的 bin 写入环境变量。 卸载过程则参考 winget 后续的动作。 dependencies 则是在 manifest 中写入所需的 exe，安装过程中搜寻整个环境变量，如果不存在则推荐安装，并不强制。 利用 GitHub API，manifest 的自动更新出问题时自动新建 issue。 数据持久化仅在 update 时进行，通过 manifest 中定义的文件/文件夹或脚本，来在不同版本文件夹间互相复制等。 当然，这只是目前的构想，后续的开发过程中一定会有所更改。\n那么问题来了，我什么时候能用上这个 CLI installer 呢？\n下周发布 PPT，今年 12 月第一阶段开源！（逃\n初探 Scoop，2018/12/31 ↩︎\nhttps://github.com/lukesampson/scoop-extras/commit/063694cae5019119e117fae5458219d8e32397d0 ↩︎\nhttps://github.com/o2sh/onefetch/releases ↩︎\nhttps://github.com/orgs/ScoopInstaller/people ↩︎\n由 Main/contributors 与 extras/contributors 得出的结论 ↩︎\nhttps://github.com/lukesampson/scoop/commits/master ↩︎\nfeat: Present download command #3782 ↩︎\nwhat-does-scoop-do ↩︎\npwsh as a dotnet global tool exhibits very unusual behavior with Ctrl-C ↩︎\nhttps://github.com/lukesampson/scoop-extras/issues/3200 ↩︎\n","wordCount":"2689","inLanguage":"zh","datePublished":"2020-05-21T15:56:06+08:00","dateModified":"2020-05-21T15:56:06+08:00","author":{"@type":"Person","name":"Jinglue"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.batkiz.com/posts/talk-about-scoop/"},"publisher":{"@type":"Organization","name":"not b@tk1z","logo":{"@type":"ImageObject","url":"https://blog.batkiz.com/favicon.ico"}}}</script><link rel=icon href=/favicon.ico sizes=16x16><link rel=apple-touch-icon href=/favicon.ico><link rel=manifest href=/favicon.ico><link rel=preconnect href=https://fonts.loli.net><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.loli.net/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap" rel=stylesheet><link href="https://fonts.loli.net/css2?family=Noto+Serif+SC&family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap" rel=stylesheet><link href="https://fonts.loli.net/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=Noto+Serif+SC&family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap" rel=stylesheet><link rel=stylesheet href=/css/main.min.28245603abfbc0a0a9ef30287c2872f82f0e6075e5b630bff570c8480b95b904.css integrity="sha256-KCRWA6v7wKCp7zAofChy+C8OYHXltjC/9XDISAuVuQQ=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>not b@tk1z
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/posts>文章</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/links>链接</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/atom.xml>RSS</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/about>关于</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/batkiz><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-social"><a class=navigation-link href=mailto:batkiz@outlook.com><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" class="main-grid-item-icon" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>在 winget 到来之际，再谈谈 scoop</h1></header><p><small>2020年5月21日&nbsp;· 2689 字&nbsp;· 6 分钟</small>
<small>·
<a href=https://blog.batkiz.com/tags/scoop/>Scoop</a>
<a href=https://blog.batkiz.com/tags/windows/>Windows</a>
<a href=https://blog.batkiz.com/tags/winget/>Winget</a></small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#谈谈-scoop-现有的问题>谈谈 scoop 现有的问题</a><ul><li><a href=#重名问题>重名问题</a></li><li><a href=#不受关注的软件>不受关注的软件</a></li><li><a href=#人手过少与软件过多>人手过少与软件过多</a></li><li><a href=#功能停滞>功能停滞</a></li><li><a href=#没有明确的-roadmap>没有明确的 roadmap</a></li><li><a href=#shim-带来的问题>shim 带来的问题</a></li><li><a href=#依赖问题>依赖问题</a></li><li><a href=#我们真的如同我们想象的那般需要-portable-吗>我们真的如同我们想象的那般需要 portable 吗</a></li></ul></li><li><a href=#设计一个-cli-installer>设计一个 CLI installer</a></li></ul></nav></div><section class=blog-content><p>Microsoft Build 2020 开发者大会在几天前召开了，除了 .NET, C# 等的常规更新之外，微软也发布了全新的、官方支持的命令行安装工具 winget。winget 出现的意义不用多说：Windows 终于迎来了受官方支持的命令行安装工具。此前虽然有 choco, scoop 等，但都只是第三方工具而已，如今微软第一方下场，无疑给开发者们带来了极大的鼓舞。</p><p>winget 的使用体验我一直有在 <a href=https://t.me/batkizc>Telegram 频道</a> 里更新，在这里不再多谈——winget 目前还没到 1.0 版本，现在只是 preview 而已，某些点今天谈完可能第二天就给更新了。或许到了 1.0 版本释出时我会再更一篇文章吧。</p><h2 id=谈谈-scoop-现有的问题>谈谈 scoop 现有的问题</h2><p>我在这里更想谈一谈 scoop 这个第三方的 <code>cli installer</code>。我一直一来都是一个 scoop 吹，本博客之前也曾介绍过 scoop<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>，但经过了这一年多的使用，我也逐渐意识到了许多问题，这些问题或许不是“痛点”，但却总让人有股隔靴搔痒的无力感。</p><h3 id=重名问题>重名问题</h3><p>当多个 bucket 内有同名 manifest 时，会按照 bucket 的顺序，自动安装最靠前的 manifest。比如我的 <a href=https://github.com/batkiz/backit>backit</a> 与 main bucket 里都存在 ffsend，执行 <code>scoop install ffsend</code> 时，scoop 会安装 backit/ffsend，而非有一个询问。虽然可以用 <code>scoop install main/ffsend</code> 来指定安装，但 scoop 官方是应该注意到这一点的，而非让用户每次都 search 一下。</p><h3 id=不受关注的软件>不受关注的软件</h3><p>scoop 的 bucket 是靠社区维护的，通常情况下这意味着 bug 更容易被发现——最先发现问题的人通常都会去开 issue 或 pull request。</p><p>但当某个软件没那么受人关注，或人们根本没有发现其问题时，就出现另一个问题了：scoop 里的软件版本滞后于官方。</p><p>比如 <a href=https://github.com/o2sh/onefetch>onefetch</a>，在 2019/11/06 的 manifest 更新 <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> 之后，onefetch 在自己的 release 里发布了 3 个新版本<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>，而 scoop 里的 manifest 再无更新。虽然这是因为 onefetch 的 release 总是变换命名风格，但 scoop 应该尽力避免这一问题。</p><h3 id=人手过少与软件过多>人手过少与软件过多</h3><p>ScoopInstaller 组织里公开显示的有 8 个人<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>，而足够活跃的仅仅有 <a href=https://github.com/r15ch13>@r15ch13</a> 与 <a href=https://github.com/Ash258>@Ash258</a> 两个人<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>，scoop 并非一个有盈利的项目，这两位也都不是全职维护 scoop，这两人除了自己的本职工作外，能有多少时间投入进来呢？</p><p>而仅 main 与 extras 两个 bucket 的软件数量，就已经达到了 1786 个，虽然有社区的力量，但每天 review PR 都够累死的。</p><p><img alt="main 与 extras 包含的 manifest 数量。2020/05/21 15:14" src=https://s1.ax1x.com/2020/05/21/Yb13Mq.png></p><p>当一个 bucket 只有 20 个软件时（指我的 backit），维护者完全有精力隔三岔五地看一眼整个的 checkver 的 log，但当一个 bucket 有 200 个时，就完全不一样了。就比如现在的 main bucket 经常会出现更新滞后的情况，毕竟更新脚本跑起来也是需要时间的。（有兴趣的可以比较一下 <a href=https://github.com/batkiz/backit>batkiz/backit</a> 与 <a href=https://github.com/ScoopInstaller/Main>ScoopInstaller/Main</a> 里 ffsend 的更新时间。）</p><h3 id=功能停滞>功能停滞</h3><p>人手过少带来的另一个问题就是 scoop 本身的功能更新几乎停滞，今年以来在 master 分支上仅仅有两个 commit<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>，还都是 fix。新功能的添加也是如此，<code>scoop download</code> 命令<a href=https://github.com/lukesampson/scoop/issues/1804>早在 2017 年就被 issue 提出</a>，而 2019/12/06 的 #3782 PR 为 scoop 添加了此功能，一直未被合并，今年 5 月又被离奇关闭<sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>。让人不得不担心 scoop 项目的发展。</p><h3 id=没有明确的-roadmap>没有明确的 roadmap</h3><p>scoop 项目至今已经发展了 7 年，却仍没有一个明确的 roadmap，功能的更新也毫无规划。官方的几位开发者除了偶尔对 scoop 进行更新外，每天在忙的就是处理 bucket 里的各种 issue，审批望不到尽头的 PR。</p><h3 id=shim-带来的问题>shim 带来的问题</h3><p>scoop 的一个功能特性就是防止 <em>Path pollution from installing lots of programs</em><sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>，由于 Windows 上并没有像 *nix 上一样强大的链接，这一点是靠所谓的 <em>shim</em> 实现的。shim 的作用基本就是对 example 生成一个非常小的 example.exe，读取 example.shim 内指定的源 example.exe 路径，（传递命令行参数并）将其启动。</p><p>这是一个非常聪明的做法，但有时候却也会带来问题。如在 Windows terminal 里，如果用 pwsh shim 作为启动的 shell，会导致对接收到的 <code>Ctrl + c</code> 的处理不正常：我们想要的是将当前正在运行的命令强行停止，pwsh shim 却会直接将 pwsh 停止。<sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup>虽然我们可以通过指定 pwsh 原路径的方法避免，但这又有违了 scoop 进行 shim 的初衷。</p><h3 id=依赖问题>依赖问题</h3><p>有些读者可能看到这里会有些迷惑，解决依赖问题怎么会成为一个问题呢？*nix 上的包管理器不都是在吹自己能处理好依赖吗？</p><p>在通常情况下有且仅有一个 package manager 的 *nix 系统之上，包管理器帮助解决依赖问题会很棒。</p><p>但在 Windows 系统上，一切都变了：几乎所有软件都没有依赖，最多是 msvc runtime/dotnet runtime；同时用户安装软件的来源也是五花八门的：从官网下载的 exe 文件、MS Store、scoop、choco 等“包管理器”等等等等。</p><p>这种情况下，当 scoop 试图接管依赖处理时，就非常令人不爽了。由于 scoop 是按 package 来设定的依赖，而非在环境变量中搜寻是否存在需要的 exe 文件。当你通过其他方式安装了 A，又想要通过 scoop 安装依赖于 A 的 B 时，scoop 只会再给你安装一份 A，非常之 unintelligible。<sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup></p><p>这样的依赖处理方式还带来了另外一个问题：卸载软件时，无法顺带卸载其不会再用到的依赖。scoop 并没有区分 lib 与 exe，这样也就无法确定你的软件是否能被安全地移除。最终只能是用户在无意间 <code>scoop list</code> 时，发现一个自己毫无印象的软件，然后将其卸载。</p><h3 id=我们真的如同我们想象的那般需要-portable-吗>我们真的如同我们想象的那般需要 portable 吗</h3><p>scoop 在普通情况下非常之 portable，理论上 <code>$env:SCOOP</code> 下的文件可以在不同电脑间相互移动，所需要的仅仅是设定好 scoop 所需要的几个环境变量——但是等等，我们真的需要这一点吗？</p><p>scoop 的 nonportable bucket 与种种以 <code>-np</code> 结尾的 manifest 已经证实了 portable 不是灵丹妙药，是不能解决所有的软件的：比如 Windows terminal 等以 appx 为打包格式的软件，根本无法指定安装地址；yarn-np 等软件如果进行极端的 portable 化会导致每次更新都丢数据。</p><p>不可否认，这个世界上有很多人同时使用多台电脑，或者想要完全的 portable 软件。但对我们这些仅仅拥有一台电脑、并不太在意软件是否是 portable 的、甚至根本不在乎环境变量是不是被污染的人呢？为了 portable, path clean 而付出的额外的代价，我们是否也应该承受呢？仅就我而言，需要的可能只是一个恰倒好处的 <em>CLI installer</em> 罢了。</p><hr><h2 id=设计一个-cli-installer>设计一个 CLI installer</h2><p>scoop 无疑是一个值得使用的 <em>package manager</em>，上面列出了的种种缺点也都是站在我个人立场上的，毕竟吾之蜜糖，彼之砒霜，适合自己的才是最好的。</p><p>但如果让我来设计的话，一个完全只符合我 <strong>个人需求</strong> 的 CLI installer 会是怎么样的呢？</p><ul><li>安装过程通过 pwsh 脚本定义，增强自由度。</li><li>对 exe, msi, appx 等用 inno, Add-AppxPackage 等安装，参考 winget。</li><li>对 zip 进行解压等，将 manifest 中定义的 bin 写入环境变量。</li><li>卸载过程则参考 winget 后续的动作。</li><li>dependencies 则是在 manifest 中写入所需的 exe，安装过程中搜寻整个环境变量，如果不存在则推荐安装，并不强制。</li><li>利用 GitHub API，manifest 的自动更新出问题时自动新建 issue。</li><li>数据持久化仅在 update 时进行，通过 manifest 中定义的文件/文件夹或脚本，来在不同版本文件夹间互相复制等。</li></ul><p>当然，这只是目前的构想，后续的开发过程中一定会有所更改。</p><p>那么问题来了，我什么时候能用上这个 CLI installer 呢？</p><p>下周发布 PPT，今年 12 月第一阶段开源！（逃</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=ttps://blog.batkiz.com/posts/2018/using-scoop/>初探 Scoop</a>，2018/12/31&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://github.com/lukesampson/scoop-extras/commit/063694cae5019119e117fae5458219d8e32397d0>https://github.com/lukesampson/scoop-extras/commit/063694cae5019119e117fae5458219d8e32397d0</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://github.com/o2sh/onefetch/releases>https://github.com/o2sh/onefetch/releases</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href=https://github.com/orgs/ScoopInstaller/people>https://github.com/orgs/ScoopInstaller/people</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>由 <a href=https://github.com/ScoopInstaller/Main/graphs/contributors>Main/contributors</a> 与 <a href=https://github.com/lukesampson/scoop-extras/graphs/contributors>extras/contributors</a> 得出的结论&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><a href=https://github.com/lukesampson/scoop/commits/master>https://github.com/lukesampson/scoop/commits/master</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p><a href=https://github.com/lukesampson/scoop/pull/3782>feat: Present download command #3782</a>&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p><a href=https://github.com/lukesampson/scoop#what-does-scoop-do>what-does-scoop-do</a>&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9><p><a href=https://github.com/PowerShell/PowerShell/issues/11314>pwsh as a dotnet global tool exhibits very unusual behavior with Ctrl-C</a>&#160;<a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10><p><a href=https://github.com/lukesampson/scoop-extras/issues/3200>https://github.com/lukesampson/scoop-extras/issues/3200</a>&#160;<a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></section><div class=paginator><a class=prev href=https://blog.batkiz.com/posts/pwsh-headers-and-messy-code/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>powershell, headers 与乱码</span></a>
<a class=next href=https://blog.batkiz.com/posts/some-pwsh-scripts/><span>一些 powershell 脚本</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2024 <a href=https://blog.batkiz.com/>not b@tk1z</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "fd2a175921e640c8a40b873fb5e58aaa"}'></script></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>